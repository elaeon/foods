{% extends "busqueda.html" %}
{% load staticfiles %}

{% block contenido_base %}
<div class="container">
<div class="starter-template">

<h2>{{ food_base.name }}</h2>

<div id="chartContainer"></div>
<div id="chartContainer2"></div>
<div id="chartContainer3"></div>
</div>
</div>

{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static 'd3.js' %}"></script>
<script type="text/javascript" src="{% static 'dimple.v2.1.2.min.js' %}"></script>


<script type="text/javascript">
var data = [];
{% for _, nutrient, value, unit in food_base.nutrients %}
    data.push({nutr: '{{ nutrient }}', value: {{ value }}, unit: '{{ unit }}', tipo: '{{ food.name }}'})
{% endfor %}

var svg = dimple.newSvg("#chartContainer", 900, 600);
var myChart = new dimple.chart(svg, data);
myChart.setBounds(60, 30, 750, 305);
var x = myChart.addCategoryAxis("x", "nutr");
x.showGridlines = true;
var y = myChart.addMeasureAxis("y", "value");
y.showGridlines = false;
var l = myChart.addSeries("tipo", dimple.plot.bar);
x.addOrderRule("nutr");
myChart.addLegend(900, 100, 60, 300, "right");
y.useLog = true;
y.logBase = 10;
myChart.draw();
x.titleShape.text("Nutriente");
y.tickFormat = ',.2f';

var data2 = [];
var total = [];
{% for food in o_foods %}
    {% for _, nutrient, value, unit in food.fnutrients %}
        data2.push({nutr: '{{ nutrient }}', value: {{ value }}, unit: '{{ unit }}', tipo: '{{ food.name }}'})
    {% endfor %}
{% endfor %}

{% for nutrient, value in f_nutrients %}
    total.push({nutr: '{{ nutrient }}', value: {{ value }}, unit: '', tipo: "x"})
{% endfor %}


var svg = dimple.newSvg("#chartContainer2", 900, 600);
var myChart = new dimple.chart(svg, total);
myChart.setBounds(60, 30, 750, 305);
var x = myChart.addCategoryAxis("x", "nutr");
x.showGridlines = true;
var y = myChart.addMeasureAxis("y", "value");
y.showGridlines = false;
var l = myChart.addSeries("tipo", dimple.plot.bar);
x.addOrderRule("nutr");
myChart.addLegend(900, 100, 60, 300, "right");
y.useLog = true;
y.logBase = 10;
myChart.draw();
x.titleShape.text("Nutriente");
y.tickFormat = ',.2f';

var svg = dimple.newSvg("#chartContainer3", 900, 600);
var myChart3 = new dimple.chart(svg, data2);
myChart3.setBounds(60, 30, 750, 305);
var x = myChart3.addCategoryAxis("x", "nutr");
x.showGridlines = true;
var y = myChart3.addPctAxis("y", "value");
y.showGridlines = false;
var l = myChart3.addSeries("tipo", dimple.plot.bar);
x.addOrderRule("nutr");
myChart3.addLegend(900, 10, 700, 300, "right");
myChart3.draw();
x.titleShape.text("Nutriente");
y.tickFormat = ',.2f';
</script>
{% endblock %}
