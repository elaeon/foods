{% extends "busqueda.html" %}
{% load staticfiles %}

{% block contenido_base %}
<div class="container">
<div class="starter-template">
<form>
<table>
<tr>
<th>Receta</th>
<th>Peso(g)</th>
</tr>
{{ formset.management_form }}
{% for form in formset %}
<tr>
<td style="padding:2px;">
{{ form.name }}
</td>
<td>{{ form.recipe }}{{ form.weight }}</td>
{% endfor %}
</table>
</form>

<br>
<p>Principales nutrientes</p>
<div id="barContainer"></div>
<h3>Energia: {{ menu.energy.0 }} {{ menu.energy.1 }}</h3>
<h3>Total de alimento consumido: {{ menu.weight }}g</h3>
<h3>Calificaci√≥n: {{ menu.score }} de 100</h3>
<h3>El radio omega es: {{ menu.radio_omega }}:1</h3>
<h3>Resumen de nutrientes que debes de checar.</h3>
<table class="table table-striped table-hover table-condensed">
<thead style="font-size: 90%">
<th>Nutriente</th>
<th>Porcentaje cubierto</th>
</thead>
<tbody>
{% for nutr, score in menu.resume_intake %}
<tr>
{% if score < 50 %}
<td><span style="color: #a00;">{{ nutr }}</span></td>
{% else %}
<td>{{ nutr }}</td>
{% endif %}
<td>{{ score }}</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static 'd3.js' %}"></script>
<script type="text/javascript" src="{% static 'dimple.v2.1.2.min.js' %}"></script>
<script type="text/javascript">
var principals = [];

{% for porcentaje, nutrdesc in menu.merged_recipes.principals_nutrients %}
principals.push({nombre: '{{ nutrdesc }}', porcentaje: {{ porcentaje }}, tipo: "principales"});
{% endfor %}

var svg = dimple.newSvg("#barContainer", 1100, 210);
var barChart = new dimple.chart(svg, principals);
barChart.setBounds(10, 30, 950, 130)
barChart.addPctAxis("x", "porcentaje");
barChart.addCategoryAxis("y", "tipo");
var barSeries = barChart.addSeries("nombre", dimple.plot.bar);
barSeries.stacked = true;
barChart.addLegend(10, 10, 1100, 30, "right");
barChart.draw();
</script>
{% endblock %}
